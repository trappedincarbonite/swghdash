<!--
# Filename: index.html
# Modified: 2026-02-22 15:58
# Description: Main dashboard UI for SWGHDash. Displays player statistics and character data with compact rows.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWGHDash</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0b0f19; 
            margin: 0;
            padding: 0;
        }
        
        /* Custom scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Mod status highlights */
        .mod-perfect { background-color: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); }
        .mod-missing { background-color: rgba(239, 68, 68, 0.15); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.2); }
        
        .search-input:focus { outline: none; border-color: #334155; box-shadow: 0 0 0 2px rgba(51, 65, 85, 0.3); }

        /* Sortable header styles */
        th.sortable { cursor: pointer; user-select: none; transition: background-color 0.2s; }
        th.sortable:hover { background-color: #374151 !important; color: #fbbf24; }

        .no-wrap { white-space: nowrap; }
    </style>
</head>
<body class="text-slate-300 min-h-screen">

    <div id="app" class="flex flex-col h-screen">
        <!-- Top Navigation Bar -->
        <header class="bg-[#0f172a] border-b border-slate-800 px-6 py-4 flex flex-row items-center flex-nowrap shrink-0 overflow-x-auto">
            
            <!-- Left Group: Brand and Stats -->
            <div class="flex items-center gap-10 shrink-0">
                <!-- Brand Section -->
                <div class="flex flex-col shrink-0">
                    <h1 class="text-xl font-black text-yellow-500 tracking-wider uppercase leading-none no-wrap">SWGHDASH</h1>
                    <span class="text-[10px] text-slate-400 font-mono mt-1 uppercase tracking-widest no-wrap">BUILD_260212_234800</span>
                </div>

                <!-- Player Stats Section -->
                <div id="header-stats" class="flex flex-nowrap items-center shrink-0 no-wrap">
                    <!-- Stats injected by JS -->
                </div>
            </div>

            <!-- Search Component -->
            <div class="ml-auto flex items-center shrink-0 pl-4">
                <input 
                    type="text" 
                    id="character-search" 
                    placeholder="Search Characters..." 
                    class="search-input bg-[#1e293b]/50 border border-slate-700 rounded-md px-4 py-1.5 text-sm w-48 lg:w-72 text-slate-200 placeholder-slate-500 transition-all"
                >
            </div>
        </header>

        <!-- Menu Bar -->
        <div class="bg-[#0f172a] border-b border-slate-800 px-6 py-2 shrink-0">
            <nav id="menu" class="flex items-center gap-4 text-[11px] font-bold text-slate-400 uppercase tracking-wide">
                <!-- Menu links injected by JS -->
            </nav>
        </div>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto bg-[#0b0f19]">
            <div class="w-full">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse table-auto relative">
                        <thead>
                            <tr id="table-header-row" class="text-slate-400 text-[11px] uppercase tracking-wide font-bold bg-[#1a2234]">
                                <!-- Headers injected by JS -->
                            </tr>
                        </thead>
                        <tbody id="unit-table-body" class="text-[12px] divide-y divide-slate-800/30">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        let allUnits = []; 
        let currentSortCol = 'name';
        let currentSortDir = 'asc';

        const columns = [
            { label: 'Name', key: 'name', sortable: true },
            { label: 'Lvl', key: 'level', sortable: true, center: true },
            { label: 'Stars', key: 'stars', sortable: true, center: true },
            { label: 'Gear', key: 'gear', sortable: true, center: true },
            { label: 'Set', key: 'set', sortable: true },
            { label: 'Arrow', key: 'arrow', sortable: true },
            { label: 'Triangle', key: 'triangle', sortable: true },
            { label: 'Circle', key: 'circle', sortable: true },
            { label: 'Cross', key: 'cross', sortable: true },
            { label: 'Square', key: 'square', sortable: true },
            { label: 'Diamond', key: 'diamond', sortable: true },
            { label: 'Set(r)', key: 'set(r)', sortable: true, italic: true },
            { label: 'Arr(r)', key: 'arrow(r)', sortable: true, italic: true },
            { label: 'Tri(r)', key: 'triangle(r)', sortable: true, italic: true },
            { label: 'Cir(r)', key: 'circle(r)', sortable: true, italic: true },
            { label: 'Cro(r)', key: 'cross(r)', sortable: true, italic: true }
        ];

        function formatNumber(num) {
            if (num === undefined || num === null || num === "") return null;
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        function formatModText(text, addNewLine = false) {
            if (!text) return '-';
            let formatted = text
                .replace(/Critical Damage/gi, "Crit Damage")
                .replace(/Critical Chance/gi, "Crit Chance")
                .replace(/Critical Avoidance/gi, "Crit Avoidance");
            
            if (addNewLine) {
                formatted = formatted.replace(/\)\s/g, ')<br>');
            }
            return formatted;
        }

        function sortUnits(units, key, direction) {
            return [...units].sort((a, b) => {
                let valA = a[key] ?? '';
                let valB = b[key] ?? '';

                if (key === 'gear') {
                    const getGearValue = (g) => {
                        if (typeof g !== 'string') return 0;
                        if (g.startsWith('R')) return 20 + parseInt(g.substring(1));
                        return parseInt(g) || 0;
                    };
                    valA = getGearValue(valA);
                    valB = getGearValue(valB);
                }

                if (typeof valA === 'number' && typeof valB === 'number') {
                    return direction === 'asc' ? valA - valB : valB - valA;
                }

                valA = valA.toString().toLowerCase();
                valB = valB.toString().toLowerCase();
                return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
            });
        }

        function handleHeaderClick(key) {
            if (currentSortCol === key) {
                currentSortDir = currentSortDir === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortCol = key;
                currentSortDir = 'asc';
            }
            renderHeader();
            renderTable();
        }

        function renderHeader() {
            const headerRow = document.getElementById('table-header-row');
            headerRow.innerHTML = '';
            columns.forEach((col, idx) => {
                const th = document.createElement('th');
                const paddingClass = (idx === 0) ? 'pl-6 pr-3 py-3' : (idx === columns.length - 1 ? 'pl-3 pr-6 py-3' : 'p-3');
                th.className = `sticky top-0 z-20 border-b border-slate-800 no-wrap ${paddingClass} ${col.sortable ? 'sortable' : ''} ${col.center ? 'text-center' : 'text-left'} ${col.italic ? 'italic opacity-60' : ''}`;
                let indicator = (currentSortCol === col.key) ? (currentSortDir === 'asc' ? ' ▴' : ' ▾') : '';
                th.innerHTML = `${col.label}${indicator}`;
                if (col.sortable) th.onclick = () => handleHeaderClick(col.key);
                headerRow.appendChild(th);
            });
        }

        function renderHeaderStats(headerData) {
            const container = document.getElementById('header-stats');
            container.innerHTML = '';
            
            const statsMapping = [
                { label: 'GP', key: 'galactic power' },
                { label: 'CHAR GP', key: 'characters gp' },
                { label: 'FLEET GP', key: 'fleet gp' },
                { label: 'ARENA WINS', key: 'arena wins' },
                { label: 'FLEET WINS', key: 'fleet arena wins' },
                { label: 'ARENA RANK', key: 'arena rank' },
                { label: 'FLEET RANK', key: 'fleet rank' }
            ];

            statsMapping.forEach((stat) => {
                const rawValue = headerData[stat.key];
                const formattedValue = formatNumber(rawValue);
                if (formattedValue !== null) {
                    const statContainer = document.createElement('div');
                    statContainer.className = "flex flex-row items-baseline gap-2 px-6 shrink-0 no-wrap border-r border-slate-800/40 last:border-0";
                    const labelSpan = document.createElement('span');
                    labelSpan.className = "text-[13px] text-slate-400 font-bold tracking-[0.1em] no-wrap";
                    labelSpan.textContent = stat.label;
                    const valSpan = document.createElement('span');
                    valSpan.className = `text-[13px] font-bold no-wrap text-yellow-500`;
                    valSpan.textContent = formattedValue;
                    statContainer.appendChild(labelSpan);
                    statContainer.appendChild(valSpan);
                    container.appendChild(statContainer);
                }
            });
        }

        async function initDashboard() {
            try {
                const response = await fetch('swgoh_data.json');
                if (!response.ok) throw new Error('Could not find swgoh_data.json');
                const data = await response.json();
                
                if (data.header) renderHeaderStats(data.header);

                allUnits = data.units || [];
                allUnits = sortUnits(allUnits, currentSortCol, currentSortDir);

                const menuContainer = document.getElementById('menu');
                const menuItems = data.menu || [];
                if (!menuItems.some(m => m.label.toLowerCase() === 'home')) {
                    menuItems.unshift({ label: "HOME", url: "#" });
                }
                menuItems.push({ label: "KYRO", url: "https://trappedincarbonite.github.io/swghdash" });

                menuItems.forEach((item) => {
                    const a = document.createElement('a');
                    a.href = item.url;
                    a.textContent = item.label;
                    a.className = "hover:text-yellow-500 transition-colors no-wrap";
                    menuContainer.appendChild(a);
                });

                renderHeader();
                renderTable();
                document.getElementById('character-search').addEventListener('input', () => renderTable());
            } catch (err) {
                console.error("Init Error:", err);
                document.getElementById('unit-table-body').innerHTML = `<tr><td colspan="16" class="p-10 text-center text-red-400">Error loading data.</td></tr>`;
            }
        }

        function renderTable() {
            const tbody = document.getElementById('unit-table-body');
            const searchQuery = document.getElementById('character-search').value.toLowerCase();
            let displayUnits = allUnits.filter(u => u.name.toLowerCase().includes(searchQuery));
            displayUnits = sortUnits(displayUnits, currentSortCol, currentSortDir);
            tbody.innerHTML = '';

            displayUnits.forEach(unit => {
                const tr = document.createElement('tr');
                // Apply hover effect and zebra striping (every even row gets a slightly lighter background)
                tr.className = "hover:bg-slate-400/20 even:bg-slate-600/10 transition-colors group";

                const getStyle = (current, recommended) => {
                    if (!recommended || recommended === "") return "text-slate-600";
                    if (!current || current === "") return "mod-missing rounded px-1.5 py-0.5 no-wrap block w-fit";
                    return current.toLowerCase().includes(recommended.toLowerCase()) 
                        ? "mod-perfect rounded px-1.5 py-0.5 font-bold no-wrap block w-fit" 
                        : "mod-missing rounded px-1.5 py-0.5 no-wrap block w-fit";
                };

                let gearStyle = "text-slate-400 font-bold no-wrap"; 
                if (unit.gear?.startsWith('R')) {
                    const rLevel = parseInt(unit.gear.replace('R', ''));
                    gearStyle = rLevel >= 7 ? "text-amber-500 font-black no-wrap" : "text-blue-500 font-black no-wrap";
                }

                const vSquareStyle = (unit.v_square_speed === "yes") ? "mod-perfect rounded px-1.5 py-0.5 no-wrap block w-fit" : "text-slate-600 no-wrap block w-fit";
                const vDiamondStyle = (unit.v_diamond_speed === "yes") ? "mod-perfect rounded px-1.5 py-0.5 no-wrap block w-fit" : "text-slate-600 no-wrap block w-fit";

                tr.innerHTML = `
                    <td class="pl-6 pr-3 py-[5px] no-wrap border-r border-slate-800/20 font-bold leading-tight">
                        <a href="${unit.url}" target="_blank" class="text-slate-100 hover:text-blue-400 transition-colors">${unit.name}</a>
                    </td>
                    <td class="px-3 py-[5px] text-center text-slate-500 font-bold leading-tight no-wrap border-r border-slate-800/20">${unit.level}</td>
                    <td class="px-3 py-[5px] text-center font-bold no-wrap border-r border-slate-800/20 ${unit.stars === 7 ? 'text-amber-600' : 'text-slate-500'}">${unit.stars}</td>
                    <td class="px-3 py-[5px] text-center border-r border-slate-800/20 ${gearStyle} leading-tight">${unit.gear}</td>
                    
                    <td class="px-3 py-[5px] leading-tight"><span class="${getStyle(unit.set, unit['set(r)']).replace('no-wrap', '')}">${formatModText(unit.set, true)}</span></td>
                    <td class="px-3 py-[5px] leading-tight no-wrap"><span class="${getStyle(unit.arrow, unit['arrow(r)'])}">${formatModText(unit.arrow, false)}</span></td>
                    <td class="px-3 py-[5px] leading-tight no-wrap"><span class="${getStyle(unit.triangle, unit['triangle(r)'])}">${formatModText(unit.triangle, false)}</span></td>
                    <td class="px-3 py-[5px] leading-tight no-wrap"><span class="${getStyle(unit.circle, unit['circle(r)'])}">${formatModText(unit.circle, false)}</span></td>
                    <td class="px-3 py-[5px] leading-tight no-wrap"><span class="${getStyle(unit.cross, unit['cross(r)'])}">${formatModText(unit.cross, false)}</span></td>
                    
                    <td class="px-3 py-[5px] no-wrap"><span class="${vSquareStyle}">${formatModText(unit.square, false)}</span></td>
                    <td class="px-3 py-[5px] no-wrap"><span class="${vDiamondStyle}">${formatModText(unit.diamond, false)}</span></td>
                    
                    <td class="px-3 py-[5px] text-slate-500 italic text-[11px] leading-tight border-l border-slate-800/20">${formatModText(unit['set(r)'], true)}</td>
                    <td class="px-3 py-[5px] text-slate-500 italic text-[11px] leading-tight no-wrap">${formatModText(unit['arrow(r)'], false)}</td>
                    <td class="px-3 py-[5px] text-slate-500 italic text-[11px] leading-tight no-wrap">${formatModText(unit['triangle(r)'], false)}</td>
                    <td class="px-3 py-[5px] text-slate-500 italic text-[11px] leading-tight no-wrap">${formatModText(unit['circle(r)'], false)}</td>
                    <td class="pl-3 pr-6 py-[5px] text-slate-500 italic text-[11px] leading-tight no-wrap">${formatModText(unit['cross(r)'], false)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
